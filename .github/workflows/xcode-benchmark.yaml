name: XcodeBenchmark

on:
  workflow_dispatch:

jobs:
  benchmark:
    runs-on: macos-latest
    steps:
      - name: Show runner info
        run: |
          echo "Runner: $(system_profiler SPHardwareDataType | grep 'Chip\|Processor Name' | head -1)"
          echo "Cores: $(sysctl -n hw.ncpu)"
          sw_vers

      - name: Clone XcodeBenchmark
        run: git clone --depth 1 https://github.com/devMEremenko/XcodeBenchmark.git

      - name: Select Xcode
        run: sudo xcode-select -s /Applications/Xcode.app

      - name: Run benchmark
        run: |
          cd XcodeBenchmark
          chmod +x benchmark.sh
          ./benchmark.sh 2>&1 | tee benchmark-output.txt

      - name: Extract result
        run: |
          echo "=== BENCHMARK RESULT ==="
          grep -E "(Time|time|seconds|minutes)" XcodeBenchmark/benchmark-output.txt || true
          echo ""
          echo "Full output:"
          cat XcodeBenchmark/benchmark-output.txt
